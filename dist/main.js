(()=>{"use strict";const e=function(e,t,n,o,r,c){const s={};return s.title=e,s.description=t,s.dueDate=n,s.completed=o,s.priority=r,s.project=c,s.due=function(){return`${e} due: ${n}`},s},t=function(e){const t={};return t.title=e,t},n={tasks:[e("Hello World","one two three","2022-01-21",!0,"high","All"),e("World Hello","one two three","2022-02-01",!1,"low","Project 2"),e("One One One","One Hello","2022-09-17",!0,"middle","Project 2"),e("Two Two Two","Two Hello","2022-01-09",!1,"high","Project 3"),e("Three Three Three","Three Hello","2022-12-25",!1,"high","All")],projects:[t("All"),t("Project 2"),t("Project 3")]};document.querySelector(".sidebar").addEventListener("click",(e=>{Array.from(document.querySelectorAll(".menu-button")).forEach((e=>e.classList.remove("active"))),null!==e.target.closest("a")&&e.target.closest("a").classList.add("active")})),function(){const e=document.querySelector(".project-modal"),c=document.querySelector(".new-project-button"),s=document.querySelector(".project-modal-close"),i=document.querySelector(".project-submit"),l=document.getElementById("new-project-form");c.addEventListener("click",(()=>{a()})),s.addEventListener("click",(()=>{d()})),i.addEventListener("click",(e=>{e.preventDefault();const c=l.title;if(o.checkTitle(c)){const e=t(c.value);n.projects.push(e),r.addProjectToView(e),o.clearForm(l),d()}}));const a=function(){e.classList.remove("hide"),e.classList.add("show")},d=function(){e.classList.remove("show"),e.classList.add("hide")}}();const o={checkTitle:e=>{let t=!1;return""===e.value.trim()?e.classList.add("error"):(e.classList.remove("error"),t=!0),t},clearForm:e=>{e.title.value=""}},r=function(){const e=document.querySelector(".project-menu"),t=document.querySelector(".form-project-selector");return{addProjectToView:t=>{e.appendChild((e=>{const t=`\n      <a href="#" class="nav-link menu-button link-dark rounded">\n        <img\n          class="bi me-2"\n          width="16"\n          height="16"\n          src="../icons/arrow-right-short.svg"\n        /><span class="d-none d-sm-inline">${e.title}</span></a\n      >`,n=document.createElement("li");return n.classList="nav-item m-1",n.innerHTML=t,n})(t))},addProjectToTodoSelectorForm:()=>{let e="";n.projects.forEach((t=>{e+=`<option>${t.title}</option>`})),t.innerHTML=e}}}(),c=(function(){const t=document.querySelector(".task-modal"),o=document.querySelector(".todo-new-task"),i=document.querySelector(".todo-modal-close"),l=document.getElementById("new-todo-form"),a=document.querySelector(".todo-submit");o.addEventListener("click",(()=>{r.addProjectToTodoSelectorForm(),d()})),i.addEventListener("click",(()=>{u()})),a.addEventListener("click",(t=>{t.preventDefault();const o=document.querySelector(".form-project-selector"),r=l.title,i=l.description,a=l.dueDate,d=o.options[o.selectedIndex].value,m=l.optradio.value;let p=c.checkTitle(r),h=c.checkDescription(i),g=c.checkDate(a);if(p&&h&&g){const t=e(r.value,i.value,a.value,!1,m,d);n.tasks.push(t),s.addTodoToView(t),c.clearForm(l),u()}}));const d=()=>{t.classList.remove("hide"),t.classList.add("show")},u=()=>{t.classList.remove("show"),t.classList.add("hide")}}(),function(){const e=e=>""===e,t=(e,t)=>{document.querySelector(".dateError").textContent=t};return{checkTitle:t=>{let n=!1;const o=t.value.trim();return e(o)?("Title cannot be empty.",document.querySelector(".titleError").textContent="Title cannot be empty."):(document.querySelector(".titleError").textContent="",n=!0),n},checkDescription:t=>{let n=!1;const o=t.value.trim();return e(o)?("Description cannot be empty.",document.querySelector(".descError").textContent="Description cannot be empty."):(document.querySelector(".descError").textContent="",n=!0),n},checkDate:n=>{let o=!1;const r=n.value.trim();return console.log(r),e(r)&&t(0,"Due date cannot be empty"),(e=>{const t=new Date(`${e}`),[n,o,r]=e.split("-"),c=new Date,s=c.getDate(),i=c.getMonth()+1;return!(+n===c.getFullYear()&&+o===i&&+r===s||t>c)})(r)?t(0,"Due date must be in the future."):(document.querySelector(".dateError").textContent="",o=!0),o},clearForm:e=>{e.title.value="",e.description.value="",e.dueDate.value=""}}}()),s=function(){const e=document.querySelector(".todo-container");return{addTodoToView:t=>{e.firstElementChild.insertAdjacentElement("beforebegin",(e=>{const t=`\n    <div\n    class="col-md-1 py-1 d-flex justify-content-md-end justify-content-center"\n  >\n    <input type="checkbox" class="task-checkbox" ${e.completed?"checked":""}/>\n  </div>\n  <div\n    class="col-md-6 d-flex align-items-center justify-content-md-start justify-content-center"\n  >\n    ${e.completed?`<del>${e.title}</del>`:`${e.title}`}\n  </div>\n    <div\n        class="col-md-1 d-flex align-items-center justify-md-start justify-content-center task-arrow"\n         >\n        <img\n         class="task-arrow-image-down"\n         width="16"\n         height="16"\n         src="../icons/caret-down.svg"\n         />\n    </div>\n  <div\n    class="col-md-2 d-flex align-items-center justify-content-md-start justify-content-center"\n  >\n    ${e.dueDate}\n  </div>\n  <div\n    class="col-md-1 d-flex align-items-center justify-md-start justify-content-center"\n  >\n      <img\n        class="task-edit"\n        width="16"\n        height="16"\n        src="../icons/pencil-square.svg"\n      />\n\n  </div>\n  <div\n    class="col-md-1 d-flex align-items-center justify-md-start justify-content-center"\n  >\n    <a href="#" class="nav-link link-dark">\n      <img\n        class=""\n        width="16"\n        height="16"\n        src="../icons/trash.svg"\n      />\n    </a>\n  </div>`,n=document.createElement("div");return n.classList="row m-4 p-2 bg-white rounded-3 border-bottom",n.innerHTML=t,n})(t))}}}(),i=(function(){document.querySelector(".todo-main-container").addEventListener("click",(r=>{const c=r.target.classList.contains("task-checkbox"),s=r.target.classList.contains("task-arrow-image-down")||r.target.classList.contains("task-arrow-image-up"),l=r.target.classList.contains("task-edit");if(r.target.classList.contains("task-delete"),c){const e=Array.from(r.target.parentNode.parentNode.childNodes),t=e[3].textContent.trim(),o=e[7].textContent.trim(),c=n.tasks.filter((e=>e.title===t&&e.dueDate===o));c[0].completed=!c[0].completed,c[0].completed?e[3].innerHTML=`<del>${e[3].innerHTML}</del>`:e[3].innerHTML=e[3].innerHTML.replace(/(<([^>]+)>)/gi,"")}if(s){let c,s,i;if(r.target.classList.contains("task-arrow-image-down")){const t=Array.from(r.target.parentNode.parentNode.childNodes);let l=r.target.parentNode;i=r.target.parentNode.parentNode,c=t[3].textContent.trim(),s=t[7].textContent.trim(),l.innerHTML=e(),console.log(c,s);const a=n.tasks.filter((e=>e.title===c&&e.dueDate===s));console.log(a);const d=o(a);i.insertAdjacentElement("afterend",d)}if(r.target.classList.contains("task-arrow-image-up")){const e=Array.from(r.target.parentNode.parentNode.childNodes);let n=r.target.parentNode;i=r.target.parentNode.parentNode,c=e[3].textContent.trim(),s=e[7].textContent.trim(),n.innerHTML=t(),i.nextElementSibling.remove()}}if(l){const e=Array.from(r.target.parentNode.parentNode.childNodes);let t=e[3].textContent.trim(),o=e[7].textContent.trim();const c=n.tasks.filter((e=>e.title===t&&e.dueDate===o));console.log(e),console.log(c),i.fillForm(c),i.open()}}));const e=()=>'\n    <img\n        class="task-arrow-image-up"\n        width="16"\n        height="16"\n        src="../icons/caret-up.svg"\n    />',t=()=>'\n    <img\n        class="task-arrow-image-down"\n        width="16"\n        height="16"\n        src="../icons/caret-down.svg"\n    />',o=e=>{console.log(e);const t=`\n    <div class="container-fluid py-1">\n      <h6 class="fw-bold">Description</h6>\n      <p class="">\n      ${e[0].description}\n      </p>\n  </div>`,n=document.createElement("div");return n.classList="modal-body mx-5 my-3 bg-light rounded-3 border border-secondary p-3 rounded-3 description-div",n.innerHTML=t,n}}(),function(){const t=document.querySelector(".edit-modal"),o=document.getElementById("edit-modal-form"),r=document.querySelector(".edit-submit"),s=document.querySelector(".edit-cancel"),i=()=>{t.classList.remove("show"),t.classList.add("hide")};return{open:()=>{t.classList.remove("hide"),t.classList.add("show")},close:i,fillForm:t=>{o.title.value=t[0].title,o.description.value=t[0].description,o.dueDate.value=t[0].dueDate,s.addEventListener("click",(()=>{c.clearForm(o),i()})),r.addEventListener("click",(r=>{r.preventDefault();const s=o.title,l=o.description,a=o.dueDate;let d=c.checkTitle(s),u=c.checkDescription(l),m=c.checkDate(a);if(d&&u&&m){e(s.value,l.value,a.value,t.completed,t.priority,t.project);const r=n.tasks.indexOf(t);console.log(r),c.clearForm(o),i()}}))}}}());n.projects.forEach((e=>r.addProjectToView(e))),n.tasks.forEach((e=>s.addTodoToView(e)))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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VVosR0FDOUIyQixPQUdGNUIsRUFBT2YsaUJBQWlCLFNBQVVDLElBQ2hDQSxFQUFNbUIsaUJBQ04sTUFBTWxDLEVBQVE4QixFQUFZLE1BQ3BCN0IsRUFBYzZCLEVBQWtCLFlBQ2hDNUIsRUFBVTRCLEVBQWMsUUFFOUIsSUFBSStCLEVBQWFOLEVBQW9CbkIsV0FBV3BDLEdBQzlDOEQsRUFBbUJQLEVBQW9CUSxpQkFBaUI5RCxHQUN4RCtELEVBQVlULEVBQW9CVSxVQUFVL0QsR0FHNUMsR0FEa0IyRCxHQUFjQyxHQUFvQkUsRUFDbkMsQ0FFQ2pFLEVBQ2RDLEVBQU1zQyxNQUNOckMsRUFBWXFDLE1BQ1pwQyxFQUFRb0MsTUFDUmhDLEVBQUtILFVBQ0xHLEVBQUtGLFNBQ0xFLEVBQUtELFNBTlAsTUFTTThHLEVBQVExRyxFQUFNQyxNQUFNMEcsUUFBUTlHLEdBQ2xDb0UsUUFBUUMsSUFBSXdDLEdBR1o1RCxFQUFvQmIsVUFBVVosR0FJOUIyQixVQXhEYyxJQWdFdEJoRCxFQUFNRSxTQUFTUSxTQUFTZCxHQUFZbUMsRUFBZ0JDLGlCQUFpQnBDLEtBQ3JFSSxFQUFNQyxNQUFNUyxTQUFTYixHQUFTNkQsRUFBU0MsY0FBYzlELE0iLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9zcmMvdGFzay5qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9zcmMvcHJvamVjdC5qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgVG9kb1Rhc2sgPSBmdW5jdGlvbiAoXG4gIHRpdGxlLFxuICBkZXNjcmlwdGlvbixcbiAgZHVlRGF0ZSxcbiAgY29tcGxldGVkLFxuICBwcmlvcml0eSxcbiAgcHJvamVjdFxuKSB7XG4gIGNvbnN0IHRhc2sgPSB7fTtcblxuICB0YXNrLnRpdGxlID0gdGl0bGU7XG4gIHRhc2suZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjtcbiAgdGFzay5kdWVEYXRlID0gZHVlRGF0ZTtcbiAgdGFzay5jb21wbGV0ZWQgPSBjb21wbGV0ZWQ7XG4gIHRhc2sucHJpb3JpdHkgPSBwcmlvcml0eTtcbiAgdGFzay5wcm9qZWN0ID0gcHJvamVjdDtcblxuICB0YXNrLmR1ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gYCR7dGl0bGV9IGR1ZTogJHtkdWVEYXRlfWA7XG4gIH07XG5cbiAgcmV0dXJuIHRhc2s7XG59O1xuXG5leHBvcnQgeyBUb2RvVGFzayB9O1xuIiwiY29uc3QgUHJvamVjdCA9IGZ1bmN0aW9uICh0aXRsZSkge1xuICBjb25zdCBwcm9qZWN0ID0ge307XG5cbiAgcHJvamVjdC50aXRsZSA9IHRpdGxlO1xuXG4gIHJldHVybiBwcm9qZWN0O1xufTtcblxuZXhwb3J0IHsgUHJvamVjdCB9O1xuIiwiLy8gVG9kbyBMaXN0IEl0ZW0gbmVlZHMgYTpcbi8vIC0gcHJvamVjdCBiZWxvbmdzIHRvXG4vLyAtIHRpdGxlXG4vLyAtIGRlc2NyaXB0aW9uXG4vLyAtIGR1ZSBkYXRlXG4vLyAtIGNvbXBsZXRlZCBjaGVjayBib3hcbi8vIC0gcmVkLCBvcmFuZ2Ugb3IgZ3JlZW4gZm9yIGRpZmZlcmVudCBwcmlvcml0aWVzXG5cbi8vIEZhY3RvcnkgZnVuY3Rpb24gZm9yIGEgdG9kbyBsaXN0IGl0ZW1cblxuLy8gUHJvamVjdCBuZWVkcyBhOlxuLy8gLSBsaXN0IG9mIHplcm8gb3IgbW9yZSB0b2RvIGl0ZW1zXG5cbi8vIEZhY3RvcnkgZnVuY3Rpb24gZm9yIGEgcHJvamVjdFxuXG4vLyBWaWV3czpcbi8vIC0gc2lkZWJhciB2aWV3XG4vLyAtIHByb2plY3Qgdmlld1xuLy8gLSBhbGwgdGFzayB2aWV3XG4vLyAtIHRvZGF5J3MgdGFza3Mgdmlld1xuLy8gLSB0aGlzIHdlZWsncyB0YXNrcyB2aWV3XG4vLyAtIHByb2plY3QncyB0YXNrcyB2aWV3XG5cbi8vIE1vZGFsczpcbi8vIC0gZWRpdCB0b2RvIGl0ZW1cbi8vIC0gY3JlYXRlIG5ldyB0b2RvIGl0ZW1cbi8vIC0gY3JlYXRlIG5ldyBwcm9qZWN0XG5cbi8vIFRvZG8gQ29udHJvbGxlcjpcbi8vIC0gZGVsZXRlIHRvZG9cbi8vIC0gc2hvdyBlZGl0IG1vZGFsXG4vLyAtIGV4cGFuZCBkZXRhaWxzXG5cbi8vIFByb2plY3QgQ29udHJvbGxlcjpcbi8vIC0gZGVsZXRlIHByb2plY3RcblxuLy9cbi8vXG4vL1xuLy9cbi8vIC8vIGNoYW5naW5nIGFjdGl2ZSBidXR0b24gb24gdGhlIG1lbnVcbi8vIC8vIGFkZGluZyBwcm9qZWN0IG1vZGFsIHdoZW4gbmV3IHByb2plY3QgaXMgcHJlc3NlZFxuLy8gLy8gYWRkaW5nIG5ldyB0b2RvIHRhc2sgbW9kYWwgd2hlbiBhZGQgYSBuZXcgcHJvamVjdCBpcyBwcmVzc2VkXG4vLyAvLyBkZWNpZGUgb24gaG93IGRhdGEgZm9yIHRhc2tzIGlzIHN0b3JlZFxuLy8gLy8gc3VibWl0dGluZyBwcm9qZWN0IG1vZGFsIGFkZHMgYSBuZXcgcHJvamVjdCAtIGhvdyBpcyBpdCBzdG9yZWQ/XG4vLyAvLyBzdWJtaXR0aW5nIHRvZG8gdGFzayBtb2RhbCBhZGRzIGEgbmV3IHRhc2sgLSBob3cgaXMgaXQgc3RvcmVkP1xuLy8gLy8gYWRkIGV2ZW50IGxpc3RlbmVycyB0byB0YXNrc1xuLy8gLy8gc2hvdyBkZXRhaWxzIHNsaWRlciB3aGVuIGRvd24gYXJyb3cgaXMgcHJlc3NlZFxuLy8gLy8gY2hhbmdlIGFycm93IGljb24gd2hlbiBkZXRhaWxzIGFyZSBzaG93aW5nIGFuZCB3aGVuIHRoZXkgYXJlIG5vdFxuLy8gLy8gY29tcGxldGluZyB0YXNrIC0gaG93IGRvZXMgaXQgaW50ZXJhY3Qgd2l0aCBkYXRhXG4vL1xuLy8gLy8gc3RyaWtlIHRocm91Z2ggdGhlIHRpdGxlIHdoZW4gdGhlIHRhc2sgaXMgY29tcGxldGVcbi8vIHNob3cgZWRpdCBzbGlkZXIgd2hlbiBlZGl0IGlzIHByZXNzZWRcbi8vIHNob3dpbmcgdGFzayBwcmlvcml0eSBjb2xvdXIgYXMgdGhlIGxlZnQgYm9yZGVyIGNvbG91ciBvZiB0aGUgdGFza1xuLy8gc3RyaWtlIHRocm91Z2ggdGhlIHRpdGxlIHdoZW4gdGhlIHRhc2sgaXMgY29tcGxldGVcbi8vIGRlbGV0ZWluZyB0YXNrIC0gaG93IGRvZXMgaXQgaW50ZXJhY3Qgd2l0aCBkYXRhXG4vLyBwb3B1bGF0ZSB0aGUgdG9kYXkgYW5kIHRoaXMgd2VlayB2aWV3cyB3aXRoIHRoZSBjb3JyZWN0IHRhc2tzXG4vLyBwb3B1bGF0ZSBlYWNoIHByb2plY3Qgd2l0aCB0aGUgY29ycmVjdCB0YXNrc1xuLy9cbi8vXG4vL1xuXG5pbXBvcnQgeyBUb2RvVGFzayB9IGZyb20gXCIuL3Rhc2suanNcIjtcbmltcG9ydCB7IFByb2plY3QgfSBmcm9tIFwiLi9wcm9qZWN0LmpzXCI7XG5cbmNvbnN0IG1vZGVsID0ge1xuICB0YXNrczogW1xuICAgIFRvZG9UYXNrKFwiSGVsbG8gV29ybGRcIiwgXCJvbmUgdHdvIHRocmVlXCIsIFwiMjAyMi0wMS0yMVwiLCB0cnVlLCBcImhpZ2hcIiwgXCJBbGxcIiksXG4gICAgVG9kb1Rhc2soXG4gICAgICBcIldvcmxkIEhlbGxvXCIsXG4gICAgICBcIm9uZSB0d28gdGhyZWVcIixcbiAgICAgIFwiMjAyMi0wMi0wMVwiLFxuICAgICAgZmFsc2UsXG4gICAgICBcImxvd1wiLFxuICAgICAgXCJQcm9qZWN0IDJcIlxuICAgICksXG4gICAgVG9kb1Rhc2soXG4gICAgICBcIk9uZSBPbmUgT25lXCIsXG4gICAgICBcIk9uZSBIZWxsb1wiLFxuICAgICAgXCIyMDIyLTA5LTE3XCIsXG4gICAgICB0cnVlLFxuICAgICAgXCJtaWRkbGVcIixcbiAgICAgIFwiUHJvamVjdCAyXCJcbiAgICApLFxuICAgIFRvZG9UYXNrKFxuICAgICAgXCJUd28gVHdvIFR3b1wiLFxuICAgICAgXCJUd28gSGVsbG9cIixcbiAgICAgIFwiMjAyMi0wMS0wOVwiLFxuICAgICAgZmFsc2UsXG4gICAgICBcImhpZ2hcIixcbiAgICAgIFwiUHJvamVjdCAzXCJcbiAgICApLFxuICAgIFRvZG9UYXNrKFxuICAgICAgXCJUaHJlZSBUaHJlZSBUaHJlZVwiLFxuICAgICAgXCJUaHJlZSBIZWxsb1wiLFxuICAgICAgXCIyMDIyLTEyLTI1XCIsXG4gICAgICBmYWxzZSxcbiAgICAgIFwiaGlnaFwiLFxuICAgICAgXCJBbGxcIlxuICAgICksXG4gIF0sXG4gIHByb2plY3RzOiBbUHJvamVjdChcIkFsbFwiKSwgUHJvamVjdChcIlByb2plY3QgMlwiKSwgUHJvamVjdChcIlByb2plY3QgM1wiKV0sXG59O1xuXG5jb25zdCBtZW51Q29udHJvbGxlciA9IChmdW5jdGlvbiAoKSB7XG4gIGNvbnN0IHNpZGViYXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnNpZGViYXJcIik7XG4gIHNpZGViYXIuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldmVudCkgPT4ge1xuICAgIHJlbW92ZUFjdGl2ZSgpO1xuICAgIGlmIChldmVudC50YXJnZXQuY2xvc2VzdChcImFcIikgPT09IG51bGwpIHJldHVybjtcbiAgICBldmVudC50YXJnZXQuY2xvc2VzdChcImFcIikuY2xhc3NMaXN0LmFkZChcImFjdGl2ZVwiKTtcbiAgfSk7XG59KSgpO1xuXG5mdW5jdGlvbiByZW1vdmVBY3RpdmUoKSB7XG4gIGxldCBidXR0b25zID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1lbnUtYnV0dG9uXCIpKTtcbiAgYnV0dG9ucy5mb3JFYWNoKChidXR0b24pID0+IGJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKFwiYWN0aXZlXCIpKTtcbn1cblxuY29uc3QgcHJvamVjdE1vZGFsID0gKGZ1bmN0aW9uICgpIHtcbiAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2plY3QtbW9kYWxcIik7XG4gIGNvbnN0IG9wZW5Nb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubmV3LXByb2plY3QtYnV0dG9uXCIpO1xuICBjb25zdCBjbG9zZU1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9qZWN0LW1vZGFsLWNsb3NlXCIpO1xuICBjb25zdCBzdWJtaXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2plY3Qtc3VibWl0XCIpO1xuICBjb25zdCBmb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJuZXctcHJvamVjdC1mb3JtXCIpO1xuXG4gIG9wZW5Nb2RhbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIHNob3dNb2RhbCgpO1xuICB9KTtcblxuICBjbG9zZU1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgaGlkZU1vZGFsKCk7XG4gIH0pO1xuXG4gIHN1Ym1pdC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2ZW50KSA9PiB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCB0aXRsZSA9IGZvcm1bXCJ0aXRsZVwiXTtcbiAgICBjb25zdCB0aXRsZVZhbGlkID0gcHJvamVjdE1vZGFsVmFsaWRhdGlvbi5jaGVja1RpdGxlKHRpdGxlKTtcbiAgICBpZiAodGl0bGVWYWxpZCkge1xuICAgICAgLy8gY3JlYXRlIHByb2plY3RcbiAgICAgIGNvbnN0IG5ld1Byb2plY3QgPSBQcm9qZWN0KHRpdGxlLnZhbHVlKTtcbiAgICAgIC8vIHB1c2ggcHJvamVjdCB0byBzdG9yYWdlXG4gICAgICBtb2RlbC5wcm9qZWN0cy5wdXNoKG5ld1Byb2plY3QpO1xuICAgICAgLy8gcmVuZGVyIHByb2plY3RcbiAgICAgIHByb2plY3RNZW51Vmlldy5hZGRQcm9qZWN0VG9WaWV3KG5ld1Byb2plY3QpO1xuICAgICAgLy8gY2xlYXIgZm9ybVxuICAgICAgcHJvamVjdE1vZGFsVmFsaWRhdGlvbi5jbGVhckZvcm0oZm9ybSk7XG4gICAgICAvLyBjbG9zZSBtb2RhbFxuICAgICAgaGlkZU1vZGFsKCk7XG4gICAgfVxuICB9KTtcblxuICBjb25zdCBzaG93TW9kYWwgPSBmdW5jdGlvbiAoKSB7XG4gICAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZShcImhpZGVcIik7XG4gICAgbW9kYWwuY2xhc3NMaXN0LmFkZChcInNob3dcIik7XG4gIH07XG5cbiAgY29uc3QgaGlkZU1vZGFsID0gZnVuY3Rpb24gKCkge1xuICAgIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoXCJzaG93XCIpO1xuICAgIG1vZGFsLmNsYXNzTGlzdC5hZGQoXCJoaWRlXCIpO1xuICB9O1xufSkoKTtcblxuY29uc3QgcHJvamVjdE1vZGFsVmFsaWRhdGlvbiA9IChmdW5jdGlvbiAoKSB7XG4gIGNvbnN0IGlzUmVxdWlyZWQgPSAodmFsdWUpID0+IHtcbiAgICByZXR1cm4gdmFsdWUgPT09IFwiXCI7XG4gIH07XG5cbiAgY29uc3Qgc2hvd0Vycm9yID0gKGlucHV0LCBtZXNzYWdlKSA9PiB7XG4gICAgaW5wdXQuY2xhc3NMaXN0LmFkZChcImVycm9yXCIpO1xuICB9O1xuXG4gIGNvbnN0IHNob3dTdWNjZXNzID0gKGlucHV0KSA9PiB7XG4gICAgaW5wdXQuY2xhc3NMaXN0LnJlbW92ZShcImVycm9yXCIpO1xuICB9O1xuXG4gIGNvbnN0IGNoZWNrVGl0bGUgPSAoZWxlbWVudCkgPT4ge1xuICAgIGxldCB2YWxpZCA9IGZhbHNlO1xuICAgIGNvbnN0IHRpdGxlID0gZWxlbWVudC52YWx1ZS50cmltKCk7XG4gICAgaWYgKGlzUmVxdWlyZWQodGl0bGUpKSB7XG4gICAgICBzaG93RXJyb3IoZWxlbWVudCwgXCJUaXRsZSBjYW5ub3QgYmUgZW1wdHkuXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzaG93U3VjY2VzcyhlbGVtZW50KTtcbiAgICAgIHZhbGlkID0gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIHZhbGlkO1xuICB9O1xuXG4gIGNvbnN0IGNsZWFyRm9ybSA9IChmb3JtKSA9PiB7XG4gICAgZm9ybVtcInRpdGxlXCJdLnZhbHVlID0gXCJcIjtcbiAgfTtcbiAgcmV0dXJuIHsgY2hlY2tUaXRsZSwgY2xlYXJGb3JtIH07XG59KSgpO1xuXG5jb25zdCBwcm9qZWN0TWVudVZpZXcgPSAoZnVuY3Rpb24gKCkge1xuICBjb25zdCBwcm9qZWN0TWVudSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvamVjdC1tZW51XCIpO1xuICBjb25zdCBmb3JtUHJvamVjdExpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmZvcm0tcHJvamVjdC1zZWxlY3RvclwiKTtcblxuICBjb25zdCBhZGRQcm9qZWN0VG9WaWV3ID0gKHByb2plY3QpID0+IHtcbiAgICBwcm9qZWN0TWVudS5hcHBlbmRDaGlsZChjcmVhdGVQcm9qZWN0Q29tcG9uZW50KHByb2plY3QpKTtcbiAgfTtcblxuICBjb25zdCBjcmVhdGVQcm9qZWN0Q29tcG9uZW50ID0gKHByb2plY3QpID0+IHtcbiAgICBjb25zdCBodG1sID0gYFxuICAgICAgPGEgaHJlZj1cIiNcIiBjbGFzcz1cIm5hdi1saW5rIG1lbnUtYnV0dG9uIGxpbmstZGFyayByb3VuZGVkXCI+XG4gICAgICAgIDxpbWdcbiAgICAgICAgICBjbGFzcz1cImJpIG1lLTJcIlxuICAgICAgICAgIHdpZHRoPVwiMTZcIlxuICAgICAgICAgIGhlaWdodD1cIjE2XCJcbiAgICAgICAgICBzcmM9XCIuLi9pY29ucy9hcnJvdy1yaWdodC1zaG9ydC5zdmdcIlxuICAgICAgICAvPjxzcGFuIGNsYXNzPVwiZC1ub25lIGQtc20taW5saW5lXCI+JHtwcm9qZWN0LnRpdGxlfTwvc3Bhbj48L2FcbiAgICAgID5gO1xuICAgIGNvbnN0IG5ld0VsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwibGlcIik7XG4gICAgbmV3RWxlbWVudC5jbGFzc0xpc3QgPSBcIm5hdi1pdGVtIG0tMVwiO1xuICAgIG5ld0VsZW1lbnQuaW5uZXJIVE1MID0gaHRtbDtcbiAgICByZXR1cm4gbmV3RWxlbWVudDtcbiAgfTtcblxuICBjb25zdCBhZGRQcm9qZWN0VG9Ub2RvU2VsZWN0b3JGb3JtID0gKCkgPT4ge1xuICAgIGxldCBodG1sID0gXCJcIjtcbiAgICBtb2RlbC5wcm9qZWN0cy5mb3JFYWNoKChwcm9qZWN0KSA9PiB7XG4gICAgICBodG1sICs9IGA8b3B0aW9uPiR7cHJvamVjdC50aXRsZX08L29wdGlvbj5gO1xuICAgIH0pO1xuICAgIGZvcm1Qcm9qZWN0TGlzdC5pbm5lckhUTUwgPSBodG1sO1xuICB9O1xuICByZXR1cm4geyBhZGRQcm9qZWN0VG9WaWV3LCBhZGRQcm9qZWN0VG9Ub2RvU2VsZWN0b3JGb3JtIH07XG59KSgpO1xuXG5jb25zdCB0b2RvTW9kYWwgPSAoZnVuY3Rpb24gKCkge1xuICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudGFzay1tb2RhbFwiKTtcbiAgY29uc3Qgb3Blbk1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi50b2RvLW5ldy10YXNrXCIpO1xuICBjb25zdCBjbG9zZU1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi50b2RvLW1vZGFsLWNsb3NlXCIpO1xuICBjb25zdCBmb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJuZXctdG9kby1mb3JtXCIpO1xuICBjb25zdCBzdWJtaXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnRvZG8tc3VibWl0XCIpO1xuXG4gIG9wZW5Nb2RhbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIHByb2plY3RNZW51Vmlldy5hZGRQcm9qZWN0VG9Ub2RvU2VsZWN0b3JGb3JtKCk7XG4gICAgb3BlbigpO1xuICB9KTtcblxuICBjbG9zZU1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgY2xvc2UoKTtcbiAgfSk7XG5cbiAgc3VibWl0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZlbnQpID0+IHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNvbnN0IGZvcm1Qcm9qZWN0U2VsZWN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5mb3JtLXByb2plY3Qtc2VsZWN0b3JcIik7XG5cbiAgICAvLyBnZXQgZm9ybSBlbGVtZW50c1xuICAgIGNvbnN0IHRpdGxlID0gZm9ybVtcInRpdGxlXCJdO1xuICAgIGNvbnN0IGRlc2NyaXB0aW9uID0gZm9ybVtcImRlc2NyaXB0aW9uXCJdO1xuICAgIGNvbnN0IGR1ZURhdGUgPSBmb3JtW1wiZHVlRGF0ZVwiXTtcbiAgICBjb25zdCBwcm9qZWN0ID1cbiAgICAgIGZvcm1Qcm9qZWN0U2VsZWN0Lm9wdGlvbnNbZm9ybVByb2plY3RTZWxlY3Quc2VsZWN0ZWRJbmRleF0udmFsdWU7XG4gICAgY29uc3QgcHJpb3JpdHkgPSBmb3JtW1wib3B0cmFkaW9cIl0udmFsdWU7XG5cbiAgICAvLyB2YWxpZGF0ZSBmb3JtIGVsZW1lbnRzXG4gICAgbGV0IHRpdGxlVmFsaWQgPSB0b2RvTW9kYWxWYWxpZGF0aW9uLmNoZWNrVGl0bGUodGl0bGUpLFxuICAgICAgZGVzY3JpcHRpb25WYWxpZCA9IHRvZG9Nb2RhbFZhbGlkYXRpb24uY2hlY2tEZXNjcmlwdGlvbihkZXNjcmlwdGlvbiksXG4gICAgICBkYXRlVmFsaWQgPSB0b2RvTW9kYWxWYWxpZGF0aW9uLmNoZWNrRGF0ZShkdWVEYXRlKTtcblxuICAgIGxldCBpc0Zvcm1WYWxpZCA9IHRpdGxlVmFsaWQgJiYgZGVzY3JpcHRpb25WYWxpZCAmJiBkYXRlVmFsaWQ7XG4gICAgLy8gY29uc3QgdGl0bGVWYWxpZCA9IHByb2plY3RNb2RhbFZhbGlkYXRpb24uY2hlY2tUaXRsZSh0aXRsZSk7XG4gICAgaWYgKGlzRm9ybVZhbGlkKSB7XG4gICAgICAvLyBjcmVhdGUgdG9kb1xuICAgICAgY29uc3QgbmV3VG9kbyA9IFRvZG9UYXNrKFxuICAgICAgICB0aXRsZS52YWx1ZSxcbiAgICAgICAgZGVzY3JpcHRpb24udmFsdWUsXG4gICAgICAgIGR1ZURhdGUudmFsdWUsXG4gICAgICAgIGZhbHNlLFxuICAgICAgICBwcmlvcml0eSxcbiAgICAgICAgcHJvamVjdFxuICAgICAgKTtcbiAgICAgIC8vIHB1c2ggdG9kbyB0byBzdG9yYWdlXG4gICAgICBtb2RlbC50YXNrcy5wdXNoKG5ld1RvZG8pO1xuICAgICAgLy8gcmVuZGVyIHRvZG9cbiAgICAgIHRvZG9WaWV3LmFkZFRvZG9Ub1ZpZXcobmV3VG9kbyk7XG4gICAgICAvLyBjbGVhciBmb3JtXG4gICAgICB0b2RvTW9kYWxWYWxpZGF0aW9uLmNsZWFyRm9ybShmb3JtKTtcbiAgICAgIC8vIGNsb3NlIG1vZGFsXG4gICAgICBjbG9zZSgpO1xuICAgIH1cbiAgfSk7XG5cbiAgY29uc3Qgb3BlbiA9ICgpID0+IHtcbiAgICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZVwiKTtcbiAgICBtb2RhbC5jbGFzc0xpc3QuYWRkKFwic2hvd1wiKTtcbiAgfTtcblxuICBjb25zdCBjbG9zZSA9ICgpID0+IHtcbiAgICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKFwic2hvd1wiKTtcbiAgICBtb2RhbC5jbGFzc0xpc3QuYWRkKFwiaGlkZVwiKTtcbiAgfTtcbn0pKCk7XG5cbmNvbnN0IHRvZG9Nb2RhbFZhbGlkYXRpb24gPSAoZnVuY3Rpb24gKCkge1xuICBjb25zdCBpc1JlcXVpcmVkID0gKHZhbHVlKSA9PiB7XG4gICAgcmV0dXJuIHZhbHVlID09PSBcIlwiO1xuICB9O1xuXG4gIGNvbnN0IG5vdEluRnV0dXJlID0gKHZhbHVlKSA9PiB7XG4gICAgY29uc3QgdGFza0RhdGUgPSBuZXcgRGF0ZShgJHt2YWx1ZX1gKTtcbiAgICBjb25zdCBbeWVhciwgbW9udGgsIGRheV0gPSB2YWx1ZS5zcGxpdChcIi1cIik7XG4gICAgY29uc3QgY3VycmVudERhdGUgPSBuZXcgRGF0ZSgpO1xuICAgIGNvbnN0IGNEYXkgPSBjdXJyZW50RGF0ZS5nZXREYXRlKCk7XG4gICAgY29uc3QgY01vbnRoID0gY3VycmVudERhdGUuZ2V0TW9udGgoKSArIDE7XG4gICAgY29uc3QgY1llYXIgPSBjdXJyZW50RGF0ZS5nZXRGdWxsWWVhcigpO1xuXG4gICAgaWYgKCt5ZWFyID09PSBjWWVhciAmJiArbW9udGggPT09IGNNb250aCAmJiArZGF5ID09PSBjRGF5KSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiAhKHRhc2tEYXRlID4gY3VycmVudERhdGUpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBzaG93VGl0bGVFcnJvciA9IChpbnB1dCwgbWVzc2FnZSkgPT4ge1xuICAgIGNvbnN0IGVycm9yID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi50aXRsZUVycm9yXCIpO1xuICAgIGVycm9yLnRleHRDb250ZW50ID0gbWVzc2FnZTtcbiAgfTtcblxuICBjb25zdCBzaG93RGVzY0Vycm9yID0gKGlucHV0LCBtZXNzYWdlKSA9PiB7XG4gICAgY29uc3QgZXJyb3IgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmRlc2NFcnJvclwiKTtcbiAgICBlcnJvci50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XG4gIH07XG4gIGNvbnN0IHNob3dEYXRlRXJyb3IgPSAoaW5wdXQsIG1lc3NhZ2UpID0+IHtcbiAgICBjb25zdCBlcnJvciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZGF0ZUVycm9yXCIpO1xuICAgIGVycm9yLnRleHRDb250ZW50ID0gbWVzc2FnZTtcbiAgfTtcblxuICBjb25zdCBzaG93VGl0bGVTdWNjZXNzID0gKGlucHV0LCBtZXNzYWdlKSA9PiB7XG4gICAgY29uc3QgZXJyb3IgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnRpdGxlRXJyb3JcIik7XG4gICAgZXJyb3IudGV4dENvbnRlbnQgPSBcIlwiO1xuICB9O1xuXG4gIGNvbnN0IHNob3dEZXNjU3VjY2VzcyA9IChpbnB1dCwgbWVzc2FnZSkgPT4ge1xuICAgIGNvbnN0IGVycm9yID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5kZXNjRXJyb3JcIik7XG4gICAgZXJyb3IudGV4dENvbnRlbnQgPSBcIlwiO1xuICB9O1xuICBjb25zdCBzaG93RGF0ZVN1Y2Nlc3MgPSAoaW5wdXQsIG1lc3NhZ2UpID0+IHtcbiAgICBjb25zdCBlcnJvciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZGF0ZUVycm9yXCIpO1xuICAgIGVycm9yLnRleHRDb250ZW50ID0gXCJcIjtcbiAgfTtcblxuICBjb25zdCBjaGVja1RpdGxlID0gKGVsZW1lbnQpID0+IHtcbiAgICBsZXQgdmFsaWQgPSBmYWxzZTtcbiAgICBjb25zdCB0aXRsZSA9IGVsZW1lbnQudmFsdWUudHJpbSgpO1xuICAgIGlmIChpc1JlcXVpcmVkKHRpdGxlKSkge1xuICAgICAgc2hvd1RpdGxlRXJyb3IoZWxlbWVudCwgXCJUaXRsZSBjYW5ub3QgYmUgZW1wdHkuXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzaG93VGl0bGVTdWNjZXNzKGVsZW1lbnQpO1xuICAgICAgdmFsaWQgPSB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gdmFsaWQ7XG4gIH07XG5cbiAgY29uc3QgY2hlY2tEZXNjcmlwdGlvbiA9IChlbGVtZW50KSA9PiB7XG4gICAgbGV0IHZhbGlkID0gZmFsc2U7XG4gICAgY29uc3QgZGVzY3JpcHRpb24gPSBlbGVtZW50LnZhbHVlLnRyaW0oKTtcbiAgICBpZiAoaXNSZXF1aXJlZChkZXNjcmlwdGlvbikpIHtcbiAgICAgIHNob3dEZXNjRXJyb3IoZWxlbWVudCwgXCJEZXNjcmlwdGlvbiBjYW5ub3QgYmUgZW1wdHkuXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzaG93RGVzY1N1Y2Nlc3MoZWxlbWVudCk7XG4gICAgICB2YWxpZCA9IHRydWU7XG4gICAgfVxuICAgIHJldHVybiB2YWxpZDtcbiAgfTtcblxuICBjb25zdCBjaGVja0RhdGUgPSAoZWxlbWVudCkgPT4ge1xuICAgIGxldCB2YWxpZCA9IGZhbHNlO1xuICAgIGNvbnN0IGR1ZURhdGUgPSBlbGVtZW50LnZhbHVlLnRyaW0oKTtcbiAgICBjb25zb2xlLmxvZyhkdWVEYXRlKTtcbiAgICBpZiAoaXNSZXF1aXJlZChkdWVEYXRlKSkge1xuICAgICAgc2hvd0RhdGVFcnJvcihlbGVtZW50LCBcIkR1ZSBkYXRlIGNhbm5vdCBiZSBlbXB0eVwiKTtcbiAgICB9XG4gICAgaWYgKG5vdEluRnV0dXJlKGR1ZURhdGUpKSB7XG4gICAgICBzaG93RGF0ZUVycm9yKGVsZW1lbnQsIFwiRHVlIGRhdGUgbXVzdCBiZSBpbiB0aGUgZnV0dXJlLlwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2hvd0RhdGVTdWNjZXNzKGVsZW1lbnQpO1xuICAgICAgdmFsaWQgPSB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gdmFsaWQ7XG4gIH07XG5cbiAgY29uc3QgY2xlYXJGb3JtID0gKGZvcm0pID0+IHtcbiAgICBmb3JtW1widGl0bGVcIl0udmFsdWUgPSBcIlwiO1xuICAgIGZvcm1bXCJkZXNjcmlwdGlvblwiXS52YWx1ZSA9IFwiXCI7XG4gICAgZm9ybVtcImR1ZURhdGVcIl0udmFsdWUgPSBcIlwiO1xuICB9O1xuICByZXR1cm4geyBjaGVja1RpdGxlLCBjaGVja0Rlc2NyaXB0aW9uLCBjaGVja0RhdGUsIGNsZWFyRm9ybSB9O1xufSkoKTtcblxuY29uc3QgdG9kb1ZpZXcgPSAoZnVuY3Rpb24gKCkge1xuICBjb25zdCB0b2RvQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi50b2RvLWNvbnRhaW5lclwiKTtcblxuICBjb25zdCBhZGRUb2RvVG9WaWV3ID0gKHRvZG8pID0+IHtcbiAgICBjb25zdCBmaXJzdENoaWxkID0gdG9kb0NvbnRhaW5lci5maXJzdEVsZW1lbnRDaGlsZDtcbiAgICBmaXJzdENoaWxkLmluc2VydEFkamFjZW50RWxlbWVudChcImJlZm9yZWJlZ2luXCIsIGNyZWF0ZVRvZG9Db21wb25lbnQodG9kbykpO1xuICB9O1xuXG4gIGNvbnN0IGNyZWF0ZVRvZG9Db21wb25lbnQgPSAodG9kbykgPT4ge1xuICAgIGNvbnN0IGh0bWwgPSBgXG4gICAgPGRpdlxuICAgIGNsYXNzPVwiY29sLW1kLTEgcHktMSBkLWZsZXgganVzdGlmeS1jb250ZW50LW1kLWVuZCBqdXN0aWZ5LWNvbnRlbnQtY2VudGVyXCJcbiAgPlxuICAgIDxpbnB1dCB0eXBlPVwiY2hlY2tib3hcIiBjbGFzcz1cInRhc2stY2hlY2tib3hcIiAke1xuICAgICAgdG9kby5jb21wbGV0ZWQgPyBcImNoZWNrZWRcIiA6IFwiXCJcbiAgICB9Lz5cbiAgPC9kaXY+XG4gIDxkaXZcbiAgICBjbGFzcz1cImNvbC1tZC02IGQtZmxleCBhbGlnbi1pdGVtcy1jZW50ZXIganVzdGlmeS1jb250ZW50LW1kLXN0YXJ0IGp1c3RpZnktY29udGVudC1jZW50ZXJcIlxuICA+XG4gICAgJHt0b2RvLmNvbXBsZXRlZCA/IGA8ZGVsPiR7dG9kby50aXRsZX08L2RlbD5gIDogYCR7dG9kby50aXRsZX1gfVxuICA8L2Rpdj5cbiAgICA8ZGl2XG4gICAgICAgIGNsYXNzPVwiY29sLW1kLTEgZC1mbGV4IGFsaWduLWl0ZW1zLWNlbnRlciBqdXN0aWZ5LW1kLXN0YXJ0IGp1c3RpZnktY29udGVudC1jZW50ZXIgdGFzay1hcnJvd1wiXG4gICAgICAgICA+XG4gICAgICAgIDxpbWdcbiAgICAgICAgIGNsYXNzPVwidGFzay1hcnJvdy1pbWFnZS1kb3duXCJcbiAgICAgICAgIHdpZHRoPVwiMTZcIlxuICAgICAgICAgaGVpZ2h0PVwiMTZcIlxuICAgICAgICAgc3JjPVwiLi4vaWNvbnMvY2FyZXQtZG93bi5zdmdcIlxuICAgICAgICAgLz5cbiAgICA8L2Rpdj5cbiAgPGRpdlxuICAgIGNsYXNzPVwiY29sLW1kLTIgZC1mbGV4IGFsaWduLWl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNvbnRlbnQtbWQtc3RhcnQganVzdGlmeS1jb250ZW50LWNlbnRlclwiXG4gID5cbiAgICAke3RvZG8uZHVlRGF0ZX1cbiAgPC9kaXY+XG4gIDxkaXZcbiAgICBjbGFzcz1cImNvbC1tZC0xIGQtZmxleCBhbGlnbi1pdGVtcy1jZW50ZXIganVzdGlmeS1tZC1zdGFydCBqdXN0aWZ5LWNvbnRlbnQtY2VudGVyXCJcbiAgPlxuICAgICAgPGltZ1xuICAgICAgICBjbGFzcz1cInRhc2stZWRpdFwiXG4gICAgICAgIHdpZHRoPVwiMTZcIlxuICAgICAgICBoZWlnaHQ9XCIxNlwiXG4gICAgICAgIHNyYz1cIi4uL2ljb25zL3BlbmNpbC1zcXVhcmUuc3ZnXCJcbiAgICAgIC8+XG5cbiAgPC9kaXY+XG4gIDxkaXZcbiAgICBjbGFzcz1cImNvbC1tZC0xIGQtZmxleCBhbGlnbi1pdGVtcy1jZW50ZXIganVzdGlmeS1tZC1zdGFydCBqdXN0aWZ5LWNvbnRlbnQtY2VudGVyXCJcbiAgPlxuICAgIDxhIGhyZWY9XCIjXCIgY2xhc3M9XCJuYXYtbGluayBsaW5rLWRhcmtcIj5cbiAgICAgIDxpbWdcbiAgICAgICAgY2xhc3M9XCJcIlxuICAgICAgICB3aWR0aD1cIjE2XCJcbiAgICAgICAgaGVpZ2h0PVwiMTZcIlxuICAgICAgICBzcmM9XCIuLi9pY29ucy90cmFzaC5zdmdcIlxuICAgICAgLz5cbiAgICA8L2E+XG4gIDwvZGl2PmA7XG4gICAgY29uc3QgbmV3RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgbmV3RWxlbWVudC5jbGFzc0xpc3QgPSBcInJvdyBtLTQgcC0yIGJnLXdoaXRlIHJvdW5kZWQtMyBib3JkZXItYm90dG9tXCI7XG4gICAgbmV3RWxlbWVudC5pbm5lckhUTUwgPSBodG1sO1xuICAgIHJldHVybiBuZXdFbGVtZW50O1xuICB9O1xuXG4gIHJldHVybiB7IGFkZFRvZG9Ub1ZpZXcgfTtcbn0pKCk7XG5cbmNvbnN0IHRhc2tzTGlzdGVuZXIgPSAoZnVuY3Rpb24gKCkge1xuICBjb25zdCB0b2RvTWFpbkNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudG9kby1tYWluLWNvbnRhaW5lclwiKTtcbiAgLy8gICBjb25zdCB0b2RvQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi50b2RvLWNvbnRhaW5lclwiKTtcblxuICB0b2RvTWFpbkNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2ZW50KSA9PiB7XG4gICAgY29uc3QgY2hlY2tib3hDb250YWluZXIgPSBldmVudC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwidGFzay1jaGVja2JveFwiKTtcbiAgICBjb25zdCBhcnJvd0NvbnRhaW5lciA9XG4gICAgICBldmVudC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwidGFzay1hcnJvdy1pbWFnZS1kb3duXCIpIHx8XG4gICAgICBldmVudC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwidGFzay1hcnJvdy1pbWFnZS11cFwiKTtcbiAgICBjb25zdCBlZGl0Q29udGFpbmVyID0gZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInRhc2stZWRpdFwiKTtcbiAgICBjb25zdCBkZWxldGVDb250YWluZXIgPSBldmVudC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwidGFzay1kZWxldGVcIik7XG5cbiAgICBpZiAoY2hlY2tib3hDb250YWluZXIpIHtcbiAgICAgIGNvbnN0IHJvdyA9IEFycmF5LmZyb20oZXZlbnQudGFyZ2V0LnBhcmVudE5vZGUucGFyZW50Tm9kZS5jaGlsZE5vZGVzKTtcbiAgICAgIGNvbnN0IHRpdGxlID0gcm93WzNdLnRleHRDb250ZW50LnRyaW0oKTtcbiAgICAgIGNvbnN0IGRhdGUgPSByb3dbN10udGV4dENvbnRlbnQudHJpbSgpO1xuXG4gICAgICBjb25zdCB0YXNrID0gbW9kZWwudGFza3MuZmlsdGVyKFxuICAgICAgICAodGFzaykgPT4gdGFzay50aXRsZSA9PT0gdGl0bGUgJiYgdGFzay5kdWVEYXRlID09PSBkYXRlXG4gICAgICApO1xuICAgICAgdGFza1swXS5jb21wbGV0ZWQgPSAhdGFza1swXS5jb21wbGV0ZWQ7XG4gICAgICBpZiAodGFza1swXS5jb21wbGV0ZWQpIHtcbiAgICAgICAgcm93WzNdLmlubmVySFRNTCA9IGA8ZGVsPiR7cm93WzNdLmlubmVySFRNTH08L2RlbD5gO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcm93WzNdLmlubmVySFRNTCA9IHJvd1szXS5pbm5lckhUTUwucmVwbGFjZSgvKDwoW14+XSspPikvZ2ksIFwiXCIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChhcnJvd0NvbnRhaW5lcikge1xuICAgICAgbGV0IHRpdGxlO1xuICAgICAgbGV0IGRhdGU7XG4gICAgICBsZXQgZGl2O1xuICAgICAgbGV0IGFycm93O1xuXG4gICAgICBpZiAoZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInRhc2stYXJyb3ctaW1hZ2UtZG93blwiKSkge1xuICAgICAgICBjb25zdCByb3cgPSBBcnJheS5mcm9tKGV2ZW50LnRhcmdldC5wYXJlbnROb2RlLnBhcmVudE5vZGUuY2hpbGROb2Rlcyk7XG4gICAgICAgIGxldCBhcnJvd0ltYWdlRGl2ID0gZXZlbnQudGFyZ2V0LnBhcmVudE5vZGU7XG4gICAgICAgIGRpdiA9IGV2ZW50LnRhcmdldC5wYXJlbnROb2RlLnBhcmVudE5vZGU7XG4gICAgICAgIHRpdGxlID0gcm93WzNdLnRleHRDb250ZW50LnRyaW0oKTtcbiAgICAgICAgZGF0ZSA9IHJvd1s3XS50ZXh0Q29udGVudC50cmltKCk7XG4gICAgICAgIGFycm93SW1hZ2VEaXYuaW5uZXJIVE1MID0gdXBBcnJvd0h0bWwoKTtcblxuICAgICAgICBjb25zb2xlLmxvZyh0aXRsZSwgZGF0ZSk7XG5cbiAgICAgICAgY29uc3QgdGFzayA9IG1vZGVsLnRhc2tzLmZpbHRlcihcbiAgICAgICAgICAodGFzaykgPT4gdGFzay50aXRsZSA9PT0gdGl0bGUgJiYgdGFzay5kdWVEYXRlID09PSBkYXRlXG4gICAgICAgICk7XG4gICAgICAgIGNvbnNvbGUubG9nKHRhc2spO1xuICAgICAgICBjb25zdCBkZXNjRGl2ID0gY3JlYXRlRGVzY3JpcHRpb25EaXYodGFzayk7XG4gICAgICAgIGRpdi5pbnNlcnRBZGphY2VudEVsZW1lbnQoXCJhZnRlcmVuZFwiLCBkZXNjRGl2KTtcbiAgICAgIH1cblxuICAgICAgaWYgKGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJ0YXNrLWFycm93LWltYWdlLXVwXCIpKSB7XG4gICAgICAgIGNvbnN0IHJvdyA9IEFycmF5LmZyb20oZXZlbnQudGFyZ2V0LnBhcmVudE5vZGUucGFyZW50Tm9kZS5jaGlsZE5vZGVzKTtcbiAgICAgICAgbGV0IGFycm93SW1hZ2VEaXYgPSBldmVudC50YXJnZXQucGFyZW50Tm9kZTtcbiAgICAgICAgZGl2ID0gZXZlbnQudGFyZ2V0LnBhcmVudE5vZGUucGFyZW50Tm9kZTtcbiAgICAgICAgdGl0bGUgPSByb3dbM10udGV4dENvbnRlbnQudHJpbSgpO1xuICAgICAgICBkYXRlID0gcm93WzddLnRleHRDb250ZW50LnRyaW0oKTtcbiAgICAgICAgYXJyb3dJbWFnZURpdi5pbm5lckhUTUwgPSBkb3duQXJyb3dIdG1sKCk7XG5cbiAgICAgICAgZGl2Lm5leHRFbGVtZW50U2libGluZy5yZW1vdmUoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoZWRpdENvbnRhaW5lcikge1xuICAgICAgY29uc3Qgcm93ID0gQXJyYXkuZnJvbShldmVudC50YXJnZXQucGFyZW50Tm9kZS5wYXJlbnROb2RlLmNoaWxkTm9kZXMpO1xuICAgICAgbGV0IHRpdGxlID0gcm93WzNdLnRleHRDb250ZW50LnRyaW0oKTtcbiAgICAgIGxldCBkYXRlID0gcm93WzddLnRleHRDb250ZW50LnRyaW0oKTtcbiAgICAgIGNvbnN0IHRhc2sgPSBtb2RlbC50YXNrcy5maWx0ZXIoXG4gICAgICAgICh0YXNrKSA9PiB0YXNrLnRpdGxlID09PSB0aXRsZSAmJiB0YXNrLmR1ZURhdGUgPT09IGRhdGVcbiAgICAgICk7XG4gICAgICBjb25zb2xlLmxvZyhyb3cpO1xuICAgICAgY29uc29sZS5sb2codGFzayk7XG4gICAgICB0b2RvRWRpdE1vZGFsLmZpbGxGb3JtKHRhc2spO1xuICAgICAgdG9kb0VkaXRNb2RhbC5vcGVuKCk7XG4gICAgfVxuICB9KTtcblxuICBjb25zdCB1cEFycm93SHRtbCA9ICgpID0+IHtcbiAgICBjb25zdCBodG1sID0gYFxuICAgIDxpbWdcbiAgICAgICAgY2xhc3M9XCJ0YXNrLWFycm93LWltYWdlLXVwXCJcbiAgICAgICAgd2lkdGg9XCIxNlwiXG4gICAgICAgIGhlaWdodD1cIjE2XCJcbiAgICAgICAgc3JjPVwiLi4vaWNvbnMvY2FyZXQtdXAuc3ZnXCJcbiAgICAvPmA7XG4gICAgcmV0dXJuIGh0bWw7XG4gIH07XG5cbiAgY29uc3QgZG93bkFycm93SHRtbCA9ICgpID0+IHtcbiAgICBjb25zdCBodG1sID0gYFxuICAgIDxpbWdcbiAgICAgICAgY2xhc3M9XCJ0YXNrLWFycm93LWltYWdlLWRvd25cIlxuICAgICAgICB3aWR0aD1cIjE2XCJcbiAgICAgICAgaGVpZ2h0PVwiMTZcIlxuICAgICAgICBzcmM9XCIuLi9pY29ucy9jYXJldC1kb3duLnN2Z1wiXG4gICAgLz5gO1xuICAgIHJldHVybiBodG1sO1xuICB9O1xuXG4gIGNvbnN0IGNyZWF0ZURlc2NyaXB0aW9uRGl2ID0gKHRhc2spID0+IHtcbiAgICBjb25zb2xlLmxvZyh0YXNrKTtcbiAgICBjb25zdCBodG1sID0gYFxuICAgIDxkaXYgY2xhc3M9XCJjb250YWluZXItZmx1aWQgcHktMVwiPlxuICAgICAgPGg2IGNsYXNzPVwiZnctYm9sZFwiPkRlc2NyaXB0aW9uPC9oNj5cbiAgICAgIDxwIGNsYXNzPVwiXCI+XG4gICAgICAke3Rhc2tbMF0uZGVzY3JpcHRpb259XG4gICAgICA8L3A+XG4gIDwvZGl2PmA7XG5cbiAgICBjb25zdCBkZXRhaWxzRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBkZXRhaWxzRGl2LmNsYXNzTGlzdCA9XG4gICAgICBcIm1vZGFsLWJvZHkgbXgtNSBteS0zIGJnLWxpZ2h0IHJvdW5kZWQtMyBib3JkZXIgYm9yZGVyLXNlY29uZGFyeSBwLTMgcm91bmRlZC0zIGRlc2NyaXB0aW9uLWRpdlwiO1xuICAgIGRldGFpbHNEaXYuaW5uZXJIVE1MID0gaHRtbDtcbiAgICByZXR1cm4gZGV0YWlsc0RpdjtcbiAgfTtcblxuICByZXR1cm4ge307XG59KSgpO1xuXG5jb25zdCB0b2RvRWRpdE1vZGFsID0gKGZ1bmN0aW9uICgpIHtcbiAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmVkaXQtbW9kYWxcIik7XG4gIGNvbnN0IGZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImVkaXQtbW9kYWwtZm9ybVwiKTtcbiAgY29uc3Qgc3VibWl0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5lZGl0LXN1Ym1pdFwiKTtcbiAgY29uc3QgY2FuY2VsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5lZGl0LWNhbmNlbFwiKTtcblxuICBjb25zdCBvcGVuID0gKCkgPT4ge1xuICAgIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRlXCIpO1xuICAgIG1vZGFsLmNsYXNzTGlzdC5hZGQoXCJzaG93XCIpO1xuICB9O1xuXG4gIGNvbnN0IGNsb3NlID0gKCkgPT4ge1xuICAgIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoXCJzaG93XCIpO1xuICAgIG1vZGFsLmNsYXNzTGlzdC5hZGQoXCJoaWRlXCIpO1xuICB9O1xuXG4gIGNvbnN0IGZpbGxGb3JtID0gKHRhc2spID0+IHtcbiAgICBmb3JtW1widGl0bGVcIl0udmFsdWUgPSB0YXNrWzBdLnRpdGxlO1xuICAgIGZvcm1bXCJkZXNjcmlwdGlvblwiXS52YWx1ZSA9IHRhc2tbMF0uZGVzY3JpcHRpb247XG4gICAgZm9ybVtcImR1ZURhdGVcIl0udmFsdWUgPSB0YXNrWzBdLmR1ZURhdGU7XG5cbiAgICBjYW5jZWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRvZG9Nb2RhbFZhbGlkYXRpb24uY2xlYXJGb3JtKGZvcm0pO1xuICAgICAgY2xvc2UoKTtcbiAgICB9KTtcblxuICAgIHN1Ym1pdC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2ZW50KSA9PiB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgY29uc3QgdGl0bGUgPSBmb3JtW1widGl0bGVcIl07XG4gICAgICBjb25zdCBkZXNjcmlwdGlvbiA9IGZvcm1bXCJkZXNjcmlwdGlvblwiXTtcbiAgICAgIGNvbnN0IGR1ZURhdGUgPSBmb3JtW1wiZHVlRGF0ZVwiXTtcbiAgICAgIC8vIHZhbGlkYXRlIGZvcm0gZWxlbWVudHNcbiAgICAgIGxldCB0aXRsZVZhbGlkID0gdG9kb01vZGFsVmFsaWRhdGlvbi5jaGVja1RpdGxlKHRpdGxlKSxcbiAgICAgICAgZGVzY3JpcHRpb25WYWxpZCA9IHRvZG9Nb2RhbFZhbGlkYXRpb24uY2hlY2tEZXNjcmlwdGlvbihkZXNjcmlwdGlvbiksXG4gICAgICAgIGRhdGVWYWxpZCA9IHRvZG9Nb2RhbFZhbGlkYXRpb24uY2hlY2tEYXRlKGR1ZURhdGUpO1xuXG4gICAgICBsZXQgaXNGb3JtVmFsaWQgPSB0aXRsZVZhbGlkICYmIGRlc2NyaXB0aW9uVmFsaWQgJiYgZGF0ZVZhbGlkO1xuICAgICAgaWYgKGlzRm9ybVZhbGlkKSB7XG4gICAgICAgIC8vIGNyZWF0ZSB0b2RvXG4gICAgICAgIGNvbnN0IG5ld1RvZG8gPSBUb2RvVGFzayhcbiAgICAgICAgICB0aXRsZS52YWx1ZSxcbiAgICAgICAgICBkZXNjcmlwdGlvbi52YWx1ZSxcbiAgICAgICAgICBkdWVEYXRlLnZhbHVlLFxuICAgICAgICAgIHRhc2suY29tcGxldGVkLFxuICAgICAgICAgIHRhc2sucHJpb3JpdHksXG4gICAgICAgICAgdGFzay5wcm9qZWN0XG4gICAgICAgICk7XG5cbiAgICAgICAgY29uc3QgaW5kZXggPSBtb2RlbC50YXNrcy5pbmRleE9mKHRhc2spO1xuICAgICAgICBjb25zb2xlLmxvZyhpbmRleCk7XG5cbiAgICAgICAgLy8gY2xlYXIgZm9ybVxuICAgICAgICB0b2RvTW9kYWxWYWxpZGF0aW9uLmNsZWFyRm9ybShmb3JtKTtcbiAgICAgICAgLy8gbW9kZWwudGFza3MuZm9yRWFjaCgodGFzaykgPT4gdG9kb1ZpZXcuYWRkVG9kb1RvVmlldyh0YXNrKSk7XG5cbiAgICAgICAgLy8gY2xvc2UgbW9kYWxcbiAgICAgICAgY2xvc2UoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcblxuICByZXR1cm4geyBvcGVuLCBjbG9zZSwgZmlsbEZvcm0gfTtcbn0pKCk7XG5cbm1vZGVsLnByb2plY3RzLmZvckVhY2goKHByb2plY3QpID0+IHByb2plY3RNZW51Vmlldy5hZGRQcm9qZWN0VG9WaWV3KHByb2plY3QpKTtcbm1vZGVsLnRhc2tzLmZvckVhY2goKHRhc2spID0+IHRvZG9WaWV3LmFkZFRvZG9Ub1ZpZXcodGFzaykpO1xuIl0sIm5hbWVzIjpbIlRvZG9UYXNrIiwidGl0bGUiLCJkZXNjcmlwdGlvbiIsImR1ZURhdGUiLCJjb21wbGV0ZWQiLCJwcmlvcml0eSIsInByb2plY3QiLCJ0YXNrIiwiZHVlIiwiUHJvamVjdCIsIm1vZGVsIiwidGFza3MiLCJwcm9qZWN0cyIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiYnV0dG9uIiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwidGFyZ2V0IiwiY2xvc2VzdCIsImFkZCIsIm1vZGFsIiwib3Blbk1vZGFsIiwiY2xvc2VNb2RhbCIsInN1Ym1pdCIsImZvcm0iLCJnZXRFbGVtZW50QnlJZCIsInNob3dNb2RhbCIsImhpZGVNb2RhbCIsInByZXZlbnREZWZhdWx0IiwicHJvamVjdE1vZGFsVmFsaWRhdGlvbiIsImNoZWNrVGl0bGUiLCJuZXdQcm9qZWN0IiwidmFsdWUiLCJwdXNoIiwicHJvamVjdE1lbnVWaWV3IiwiYWRkUHJvamVjdFRvVmlldyIsImNsZWFyRm9ybSIsImVsZW1lbnQiLCJ2YWxpZCIsInRyaW0iLCJwcm9qZWN0TWVudSIsImZvcm1Qcm9qZWN0TGlzdCIsImFwcGVuZENoaWxkIiwiaHRtbCIsIm5ld0VsZW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiaW5uZXJIVE1MIiwiY3JlYXRlUHJvamVjdENvbXBvbmVudCIsImFkZFByb2plY3RUb1RvZG9TZWxlY3RvckZvcm0iLCJ0b2RvTW9kYWxWYWxpZGF0aW9uIiwib3BlbiIsImNsb3NlIiwiZm9ybVByb2plY3RTZWxlY3QiLCJvcHRpb25zIiwic2VsZWN0ZWRJbmRleCIsInRpdGxlVmFsaWQiLCJkZXNjcmlwdGlvblZhbGlkIiwiY2hlY2tEZXNjcmlwdGlvbiIsImRhdGVWYWxpZCIsImNoZWNrRGF0ZSIsIm5ld1RvZG8iLCJ0b2RvVmlldyIsImFkZFRvZG9Ub1ZpZXciLCJpc1JlcXVpcmVkIiwic2hvd0RhdGVFcnJvciIsImlucHV0IiwibWVzc2FnZSIsInRleHRDb250ZW50IiwiY29uc29sZSIsImxvZyIsInRhc2tEYXRlIiwiRGF0ZSIsInllYXIiLCJtb250aCIsImRheSIsInNwbGl0IiwiY3VycmVudERhdGUiLCJjRGF5IiwiZ2V0RGF0ZSIsImNNb250aCIsImdldE1vbnRoIiwiZ2V0RnVsbFllYXIiLCJub3RJbkZ1dHVyZSIsInRvZG9Db250YWluZXIiLCJ0b2RvIiwiZmlyc3RFbGVtZW50Q2hpbGQiLCJpbnNlcnRBZGphY2VudEVsZW1lbnQiLCJjcmVhdGVUb2RvQ29tcG9uZW50IiwidG9kb0VkaXRNb2RhbCIsImNoZWNrYm94Q29udGFpbmVyIiwiY29udGFpbnMiLCJhcnJvd0NvbnRhaW5lciIsImVkaXRDb250YWluZXIiLCJyb3ciLCJwYXJlbnROb2RlIiwiY2hpbGROb2RlcyIsImRhdGUiLCJmaWx0ZXIiLCJyZXBsYWNlIiwiZGl2IiwiYXJyb3dJbWFnZURpdiIsInVwQXJyb3dIdG1sIiwiZGVzY0RpdiIsImNyZWF0ZURlc2NyaXB0aW9uRGl2IiwiZG93bkFycm93SHRtbCIsIm5leHRFbGVtZW50U2libGluZyIsImZpbGxGb3JtIiwiZGV0YWlsc0RpdiIsImNhbmNlbCIsImluZGV4IiwiaW5kZXhPZiJdLCJzb3VyY2VSb290IjoiIn0=